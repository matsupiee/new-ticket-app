# 開発計画書

## 目次

1. [プロジェクト概要](#1-プロジェクト概要)
2. [技術スタック](#2-技術スタック)
3. [開発フェーズ](#3-開発フェーズ)
4. [API 設計](#4-api-設計)
5. [admin フロントエンド設計](#5-admin-フロントエンド設計)
6. [web フロントエンド設計](#6-web-フロントエンド設計)
7. [テスト戦略](#7-テスト戦略)

---

## 1. プロジェクト概要

### 1.1 プロダクト概要

イベント主催者とチケット購入者を結ぶ総合チケット販売プラットフォームです。

**主要機能:**

- イベント・公演・チケット管理
- 先着/抽選/希望制の販売方式
- 複数決済手段（GMO、楽天、コンビニ）
- 電子チケット（QR コード）/ 紙チケット対応
- 入場管理システム

### 1.2 ユーザー種別

| ユーザー種別           | 説明                                                   |
| ---------------------- | ------------------------------------------------------ |
| 一般ユーザー           | チケット購入者                                         |
| 主催者                 | イベント・公演を管理する事業者                         |
| プラットフォーム管理者 | 全ての主催者の情報を閲覧できる。特別な設定なども行える |

---

## 2. 追加予定の技術

| カテゴリ   | 技術                 | 用途                                           |
| ---------- | -------------------- | ---------------------------------------------- |
| キュー     | BullMQ + Redis       | バックグラウンドジョブ（抽選処理、メール送信） |
| ストレージ | Google Cloud Storage | 画像・チケット PDF 保存                        |
| メール     | Resend               | 通知メール送信                                 |

---

## 3. 開発プラン

### 1. イベント一覧ページ

イベントの一覧を表示する
公演名・会場名で検索
作成日・開場日でソート

### 2. イベント作成ページ

イベント一覧ページの右上の作成ボタンを押すと遷移できる

入力項目

- イベント名
- イベント詳細
- メイン画像
- 追加画像
- 問い合わせ先名
- 問い合わせ先住所
- ステージ情報（複数可）
  - 公演名（1 ステージしかない場合で空欄だったら、イベント名をそのままコピーして保存）
  - 会場名
  - 開場時刻（現在時刻より後）
  - 開演時刻（開場時刻より後）
  - 出演アーティスト一覧

### 3. 販売スケジュール・券種の設定ページ

#### 販売スケジュール

##### 入力項目

- スケジュール名
- 説明文
- 公開日時
- 販売開始日時
- 販売終了日時
- 抽選予定日時
- 指定席チケットの発券予定日
- 支払い方法
- 販売方式（先着 or 抽選）
- 抽選の場合の設定
  - 抽選方式、抽選開始日時、抽選結果発表日時
- sms 認証必須かどうか
- コンビニ支払いの期限(支払い方法でコンビニが可能になっている場合だけ設定)

##### バリデーション

- スケジュールが公開中ステータスの場合はいじれない
- 販売開始日時は開演日以前であること
- 販売終了日時は開演日以前であること
- 販売終了日時は販売開始日時以降であること

#### 券種（TicketType）

##### 券種タイプ

| タイプ       | 説明                              |
| ------------ | --------------------------------- |
| **`normal`** | 番号なし券種                      |
| **`seat`**   | 座席指定券種                      |
| **`queue`**  | 整理番号付き券種（接頭辞 + 連番） |

##### 入力項目

- 券種タイプ
- 券種の名前
- 詳細説明文
- 基本価格
  - プラットフォームが基本価格から何%取るかを設定する
- 販売可能枚数
- 一度のみ申し込み可能かどうか
- QR コードのみ入場可能か
- 手数料の設定
  - システム手数料はデフォルトで必ず設定する必要がある

##### バリデーション

- スケジュールが公開中ステータスの場合はいじれない

---

## 4. テスト戦略

### 4.1 テストの種類

server サイドだけ実装

| 種類           | ツール | 対象                             |
| -------------- | ------ | -------------------------------- |
| ユニットテスト | Vitest | ビジネスロジック、ユーティリティ |

### 3.2 テスト環境

```
# テストDB（Docker）
docker compose -f docker-compose.test.yml up -d

# テスト実行
pnpm test           # ユニットテスト
```

---

### 用語集

| 用語                             | 説明                           |
| -------------------------------- | ------------------------------ |
| 公演（Stage）                    | イベント内の個別の開催枠       |
| 販売スケジュール（SaleSchedule） | 販売期間・方式を定義したもの   |
| 券種（TicketType）               | チケットの種類（S 席、A 席等） |
